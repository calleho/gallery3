function JphUtil_PreloaderItem(a,b){this.mhImage=a,this.mSrc=b}function JphUtil_Preloader(a){this.mMaxActiveCount=a,this.mActiveCount=0,this.mPaused=!1,this.maAllImages=[],this.maQueue=new Array}function attach_method(a,b,c,d){if(a==null||a==undefined)throw new Error("Empty master object passed ["+b+"]["+c+"]["+d+"]");a[b]=function(a){c[d](a)}}function JphThumbs_Manager(a){this.mrApp=a,this.mhThumbnails=null,this.mhThumbsTopBar=null,this.mhThumbsContainer=null,this.mhThumbsCount=null,this.mvThumbsIndex=null,this.mvThumbsIndexOld=0,this.mInitialized=!1,this.mrPreloader=null,this.maThumbnails=new Array}function JphThumbs_Item(a,b){this.mrApp=a,this.mrImage=b,this.mhDiv=null,this.mhImage=null}function get_html_attribute(a,b){var c=new Array;return c[c.length]=" ",c[c.length]=a,c[c.length]='="',c[c.length]=b,c[c.length]='"',c.join("")}function Jph_Image(a,b,c,d,e,f){d==undefined&&(d=""),e==undefined&&(e="image"),this.mIndex=a,this.mSrcThumb=c,this.mSrc=b,this.mTitle=d,this.mType=e,this.mThumbStyle=f}function Jph_Dao(){this.maImages=new Array}function Jph_Application(a){this.mrDao=a,this.mrThumbnails=null}JphUtil_PreloaderItem.prototype.LoadImage=function(){this.mhImage.src=this.mSrc},JphUtil_PreloaderItem.prototype.toString=function(){return"JphUtil_PreloaderItem ["+this.mSrc+"]["+this.mhImage.getAttribute("src")+"]"},JphUtil_Preloader.prototype.Pause=function(){this.mPaused=!0},JphUtil_Preloader.prototype.Load=function(a,b){if(this.maAllImages[b]!=undefined){a.src=b,this._ImageLoaded(b);return}var c=new JphUtil_PreloaderItem(a,b);this.maAllImages[b]=c,this.mActiveCount<this.mMaxActiveCount?this._LoadItem(c):this.maQueue[this.maQueue.length]=c},JphUtil_Preloader.prototype._LoadItem=function(a){this.mActiveCount++,attach_method(a.mhImage,"onload",this,"_ImageLoaded"),attach_method(a.mhImage,"onerror",this,"_ImageError"),a.LoadImage()},JphUtil_Preloader.prototype._ImageError=function(a){if(!a)var a=window.event;var b=a.target?a.target:a.srcElement;this.mActiveCount--,delete this.maAllImages[b.src],this.mPaused||this._LoadNext()},JphUtil_Preloader.prototype._ImageLoaded=function(a){if(typeof a=="string")var b=a;else{if(!a)var a=window.event;var c=a.target?a.target:a.srcElement,b=c.src}this.mActiveCount--,this.mPaused||this._LoadNext()},JphUtil_Preloader.prototype._LoadNext=function(){this.maQueue.length&&this._LoadItem(this.maQueue.shift())},JphUtil_Preloader.prototype.toString=function(){return"[JphUtil_Preloader [queue length="+this.maQueue.length+"][active count="+this.mActiveCount+"]]"},JphThumbs_Manager.prototype.Create=function(){this.mhThumbsTopBar=document.getElementById("thumbs-toolbar-top"),this.mhThumbnails=document.getElementById("thumbs-images-container"),this.mhThumbsContainer=document.getElementById("thumbs-container"),this.mhThumbsCount=document.getElementById("thumbs-count-text"),this.mhThumbsLoadMore=document.getElementById("thumbs-load-more"),this.mrApp.mrDao.maImages.length>MAX_LOADING_THUMBNAILS?this.mvThumbsIndex=MAX_LOADING_THUMBNAILS:this.mvThumbsIndex=this.mrApp.mrDao.maImages.length;for(var a=this.mvThumbsIndexOld;a<this.mvThumbsIndex;a++)this.maThumbnails[this.maThumbnails.length]=new JphThumbs_Item(this.mrApp,this.mrApp.mrDao.maImages[a]);this.mrPreloader=new JphUtil_Preloader(MAX_CONCURENT_LOADING_THUMBNAILS)},JphThumbs_Manager.prototype.Init=function(){var a=document.createElement("div");a.innerHTML=this._HtmlThumbs();while(a.firstChild)this.mhThumbnails.appendChild(a.firstChild);this.mhThumbsCount.innerHTML=this._HtmlCount(),this.mrApp.mrDao.maImages.length==this.mvThumbsIndex&&this.HideLoadMore();for(var b=this.mvThumbsIndexOld;b<this.maThumbnails.length;b++)this.maThumbnails[b].Init();this.mInitialized=!0},JphThumbs_Manager.prototype._HtmlThumbs=function(){var a=new Array,b=0;for(var c=this.mvThumbsIndexOld;c<this.maThumbnails.length;c++)a[b++]=this.maThumbnails[c].Html();return a.join("")},JphThumbs_Manager.prototype._HtmlCount=function(){var a=this.mrApp.mrDao.maImages.length;if(this.mrApp.mrDao.maImages.length==this.mvThumbsIndex)var b=a+" items";else var b=this.mvThumbsIndex+" of "+a+" items";return a==1&&(b=a+" item"),b},JphThumbs_Manager.prototype.Show=function(){this.mInitialized||this.Init(),this.mhThumbnails.style.display="block",this.mhThumbsContainer.style.display="block",document.body.className="thumbs"},JphThumbs_Manager.prototype.HideLoadMore=function(){this.mhThumbsLoadMore.style.display="none"},JphThumbs_Manager.prototype.LoadMore=function(){this.mvThumbsIndexOld=this.mvThumbsIndex,this.mrApp.mrDao.maImages.length>this.mvThumbsIndex+MAX_LOADING_THUMBNAILS?this.mvThumbsIndex=this.mvThumbsIndex+MAX_LOADING_THUMBNAILS:this.mvThumbsIndex=this.mrApp.mrDao.maImages.length;for(var a=this.mvThumbsIndexOld;a<this.mvThumbsIndex;a++)this.maThumbnails[this.maThumbnails.length]=new JphThumbs_Item(this.mrApp,this.mrApp.mrDao.maImages[a]);this.Init()},JphThumbs_Item.prototype.Init=function(){this.mhDiv=document.getElementById(this.GetHtmlId("thumb_div")),this.mhImage=document.getElementById(this.GetHtmlId("thumb_img")),this.mrApp.mrThumbnails.mrPreloader.Load(this.mhImage,this.mrImage.mSrcThumb)},JphThumbs_Item.prototype.Html=function(){var a=new Array,b=0;return a[b++]='<div class="thumbnail"',a[b++]=get_html_attribute("id",this.GetHtmlId("thumb_div")),a[b++]=">",this.mrImage.mType=="album"&&(a[b++]='<a href="',a[b++]=this.mrImage.mSrc,a[b++]='">'),a[b++]="<img",a[b++]=get_html_attribute("id",this.GetHtmlId("thumb_img")),a[b++]=get_html_attribute("title",this.mrImage.mTitle),a[b++]=get_html_attribute("src",BASE_URL+"dummy.gif"),a[b++]=get_html_attribute("style",this.mrImage.mThumbStyle),this.mrImage.mType!="album"&&(a[b++]=get_html_attribute("onclick","slidemgr.show("+this.mrImage.mIndex+");")),a[b++]="/>",this.mrImage.mType=="album"&&(a[b++]='<div class="thumb-title">',a[b++]=this.mrImage.mTitle,a[b++]="</div>",a[b++]="</a>"),a[b++]="</div>",a.join("")},JphThumbs_Item.prototype.GetHtmlId=function(a){return this.mrImage.mIndex+"_"+a},Jph_Dao.prototype.ReadImage=function(a,b,c,d,e,f){var g=new Jph_Image;g.mIndex=a,g.mSrcThumb=c,g.mSrc=b,g.mTitle=d,g.mType=e,g.mThumbStyle=f,this.maImages[g.mIndex]=g},Jph_Application.prototype.Init=function(){this.mrThumbnails=new JphThumbs_Manager(this),this.mrThumbnails.Create(),this.mrThumbnails.Show()},Jph_Application.prototype.LoadMoreThumbs=function(){this.mrThumbnails.LoadMore(),this.ScrollDown("thumbs-count-text")},Jph_Application.prototype.NormalizeVertical=function(){setTimeout("scrollTo(0,1)",100)},Jph_Application.prototype.currentYPosition=function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0},Jph_Application.prototype.elmYPosition=function(a){var b=document.getElementById(a),c=b.offsetTop,d=b;while(d.offsetParent&&d.offsetParent!=document.body)d=d.offsetParent,c+=d.offsetTop;return c},Jph_Application.prototype.ScrollDown=function(a){var b=this.currentYPosition(),c=this.elmYPosition(a),d=c>b?c-b:b-c;if(d<100){scrollTo(0,c);return}var e=Math.round(d/100);e>=20&&(e=20);var f=Math.round(d/25),g=c>b?b+f:b-f,h=0;if(c>b){for(var i=b;i<c;i+=f)setTimeout("window.scrollTo(0, "+g+")",h*e),g+=f,g>c&&(g=c),h++;return}for(var i=b;i>c;i-=f)setTimeout("window.scrollTo(0, "+g+")",h*e),g-=f,g<c&&(g=c),h++}
